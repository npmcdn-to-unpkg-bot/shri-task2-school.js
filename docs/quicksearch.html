<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"global.html":{"id":"global.html","title":"Global","body":" school.js Classes SchoolSchoolArray Global Global Global Type Definitions Mentor Type: Object Properties: Name Type Description name string mentor's name capacity Number How many students the mentor are ready to take prefList Array.&lt;Number&gt; Mentor's preferences list (descending. 0 index for the most desired student) prefResults Array.&lt;String&gt; The list of students building based on preferences lists all students and all mentors PrefResult Type: Object Properties: Name Type Description id Number Mentor's ID students Array.&lt;String&gt; The list of students ResultCollection Type: Object Properties: Type Description SchoolArray SchoolArray for Students, Tasks and Mentors Array.&lt;Team&gt; TeamsArray for Teams Error for unknown collection names Student Type: Object Properties: Name Type Description name string student's name team string student's team prefList Array.&lt;Number&gt; Student's preferences list (descending. 0 index for the most desired mentor) %TaskId% Number Student's mark for the task with id. Team Type: Object Properties: Name Type Description name string name of the team students Array.&lt;Student&gt; Array of students in the group × Search results Close "},"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" school.js Classes SchoolSchoolArray Global Global Classes Classes School SchoolArray × Search results Close "},"index.html":{"id":"index.html","title":"Index","body":" school.js Classes SchoolSchoolArray Global Global school.jsДля чего?Библиотека предосталяет простой программный интерфейс для работы с процессом обучения ШРИ. Для хранения используется IndexedDB, но вам совсем необязательно знать ее особенности. Что умеет Инициализировать курсconst shri = new School('Shri-2016-Moscow'); Получать все элементы колекции (students, mentors, tasks)shri .getCollection('students') .then((result) =&gt; { // your code }); Получать элементы по условиюshri .getCollectionWhere('students', 'team', 'SuperStars') .then((result) =&gt; { // your code }); Создавать студентов, менторов, заданияshri .getCollection('tasks') .then((result) =&gt; { result.add({name: 'CSS project', type: 'team'}); }); Обновлять (например выставление оценки группе)const taskId = 1; shri .getCollectionWhere('students', 'team', 'SupreStars') .then((result) =&gt; { result.update({taskId: 5}); // five for all team }); Удалять и поддерживать целостность БДshri .getCollectionWhere('students', 'id', 2) .then((result) =&gt; { result.remove(); }); Решать задачу распределения студентов по менторам (используется алгоритм устойчивых паросочетаний) shri.transaction(() =&gt; { shri .getCollection('students') .then((result) =&gt; { result.add([[ {name: 'student1', prefList: [2, 1]}, // Список с предпочтениями, {name: 'student2', prefList: [1, 2]}, // где ид с 0 индексом - самй желаемый ментор {name: 'student3', prefList: [1, 2]}, {name: 'student4', prefList: [1, 2]}, {name: 'student5', prefList: [1, 2]} ]]); }); shri .getCollection('mentors') .then((result) =&gt; { result.add([[ {name: 'mentor1', capacity: 1, prefList: [1, 2, 3, 4, 5]}, {name: 'mentor2', capacity: 2, prefList: [1, 2, 3, 4, 5]} ]]); }); }).then(() =&gt; { const resultLists = shri.calcPrefLists(); // К ментору1 попадет студент2, // а к метору2 попадут студент1 и студент3 });Документацияhttps://vchagaev.github.io/shri-task2-school.js/docs/index.html Комментарий к заданиюПроектированиеЧто же нужно будет пользователю моей библиотеки?Начнем с самого главного - цель библиотеки. Она должна облегчить разработчику приложения для ШРИ работу с данными. Что бы он не задумывался о целостности данных и особенностях работы с IndexedDB, а сконцентрировался на логике. Соответственно API должен быть гибким и простым. Я примерно спроектировал имена классов и как бы я хотел с ними работать будь я разработчиком приложения. Изначально я спроектировал с расширением промисов или стэком операций, но понял, что имплеменитировать качественно я такое не смогу, поэтому решил реализовать используя промисы. Выбор места храненияИз цели понятно, что придется делать CRUD в браузере. Для такой задачи необходимо хранилище, а так как бэкэнд у нас не подразумевается, то такое хранилище должно быть в браузере. Из выбора у нас LocalStorage, IndexDB, WebSQL и кэш. LocalStorage для такой задачи совершенно не подходит как и кэш. WebSQL больше не поддерживается и будущее его не понятно. Из плючов - это SQL а я с ним работал :) IndexedDB NO SQL БД. Исходя из специфики задания, а нам не нужно поддерживать какую-то сумашедшую целостность данных я выбрал IndexedDB. Примерно спроектировал как у меня все будет храниться. Самая частая операция - выставление оценок и именно под нее проектировал данные. Выбор инструмента для работы с IndexedDBПосмотрев стандартный API IndexedDB и сравнив его с API врапперов и их фичами, то решил использовать wrapper. Мне нужен был простой - для запросов и CRUD действий и простым интерфейсом. Выбор пал на Dexie.js https://github.com/dfahlander/Dexie.js. Легкая, документируемая, без вербозного API. Как раз то что нужно. ТестированиеДля тестирования решил применить Jasmine и Karma. Jasmine - хороший фреймворк, которым я пользовался. Тестировать нужно в боевой среде - браузере. Поэтому Karma - для прогонки тестов в браузере и анализ покрытия кода. Вместе хорошо работают + не вижу причин не использовать их или использовать что-то другое. Покрыл бибилиотеку тестами на все основные кейсы. Реализация При реализации использовал промисы для работы с асинхронностью. В целом старался придерживаться стандарту ECMA 6. Для код-стайла JSCS, а линтер - ESLint. Старался придерживаться код стайлу https://github.com/ymaps/codestyle. При реализации решил расширить массив для работы с коллекциями. Экспорт и импорт Экспортировать и импортировать решил использую JSON. В принице с ними ничего сложного, так как IndexedDB в себе хранит объекты. ДокументацияСгенерировал докуменацию на основе JSDoc комментов. Использовал описание классов. Веб-интерфейсДля реализации веб-интерфейса планировал использваоть какой-нибудь MVC-фреймворк (Angular или поразбирался бы с BEM MVC). По возможности использовал бы Drag &amp; Drop (ранжирование списков предпочтений или распределение студентов по командам) × Search results Close "},"School.html":{"id":"School.html","title":"Class: School","body":" school.js Classes SchoolSchoolArray Global Global Class: School School School is a library that provides a simple interface to work with processes of SHRI. School is the main class and the default export of the library. An instance of this class represents an interface to work with IndexedDB. Using Dexie.js wrapper. new School(dbName) Create a school instance Parameters: Name Type Description dbName string name for IndexedDB instance where all data will be stored Members dexieObject Gets Dexie.js object (For testing purpose only) Methods calcPrefLists() Finds for students the most appropriate mentors according preference lists. All students' and mentors' preference lists must be valid (Each student ranks each mentors and vice versa) Using Donald Knuth's basic algorithm about stable marriages Returns: array of pref results Type Promise.&lt;Array.&lt;PrefResult&gt;&gt; exportToJson() Exports school's data (database) to JSON string Returns: String with JSON or error Type Promise.&lt;(String|Error)&gt; getCollection(collectionName) Gets all elements of collection by name to work with it Parameters: Name Type Description collectionName string name of the colletion (Students, Mentors, Tasks, Teams) Returns: Promise with the results array Type Promise.&lt;ResultCollection&gt; getCollectionWhere(collectionName, field, value) Gets collection with 'where' clause Parameters: Name Type Description collectionName String name of the colletion (Students, Mentors, Tasks, Teams) field String Field name value String | Number | Array value to filter by Returns: Promise with the results array Type Promise.&lt;ResultCollection&gt; importFromJson(json) Validates json and replaces current data with data from JSON Parameters: Name Type Description json String string with imported JSON Returns: Error if validation or import failed Type Promise.&lt;(undefined|Error)&gt; transaction(funcToExecute) Start a database transaction. Will wait until all operations are executed Parameters: Name Type Description funcToExecute function which function will be executed Returns: when everything has done Type Promise.&lt;(undefined|Error)&gt; × Search results Close "},"SchoolArray.html":{"id":"SchoolArray.html","title":"Class: SchoolArray","body":" school.js Classes SchoolSchoolArray Global Global Class: SchoolArray SchoolArray Class is a service class that provides a simple interface to work with CRUD events new SchoolArray(dexieDb, dexieTable, initialArray) Constructor for the service class SchoolArray Parameters: Name Type Description dexieDb Dexie instance Dexie.js dexieTable string Dexie.js table name initialArray Array.&lt;(Student|Mentor|Task)&gt; items to be initialized Extends Array Methods add(obj) Adds item/items to current collection Parameters: Name Type Description obj Array.&lt;Object&gt; | Object Object(s) to add Returns: id of the last added item Type Promise.&lt;(Number|Error)&gt; getIds() Gets ids of current array Returns: Ids of the current array Type Array.&lt;Number&gt; remove(ids) Removes items from the collection by ids or by current array ids and maintains the database Parameters: Name Type Argument Description ids Array.&lt;Number&gt; &lt;optional&gt; Ids for removing in the collection Returns: Type Promise update(changes, ids) Updates items in the collection by ids or by current array ids Parameters: Name Type Argument Description changes Object New data ids Array.&lt;Number&gt; &lt;optional&gt; Ids for updating in the collection Returns: Type Promise.&lt;(undefined|Error)&gt; × Search results Close "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
